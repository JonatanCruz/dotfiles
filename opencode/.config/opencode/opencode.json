{
  "$schema": "https://opencode.ai/config.json",

  // ============================================================================
  // APPEARANCE & UI
  // ============================================================================

  "theme": "catppuccin",

  "tui": {
    "scroll_speed": 3,
    "scroll_acceleration": {
      "enabled": true
    },
    "diff_style": "auto"
  },

  // ============================================================================
  // MODELS & PROVIDERS
  // ============================================================================

  "model": "anthropic/claude-sonnet-4-5",
  "small_model": "anthropic/claude-haiku-4-5",

  "provider": {
    "anthropic": {
      "options": {
        "timeout": 600000,
        "setCacheKey": true
      }
    }
  },

  // ============================================================================
  // AGENTS
  // ============================================================================

  "default_agent": "build",

  "agent": {
    "build": {
      "description": "Full development mode with all tools enabled",
      "mode": "primary",
      "temperature": 0.3
    },
    "plan": {
      "description": "Analysis and planning without making changes",
      "mode": "primary",
      "temperature": 0.1,
      "permission": {
        "edit": "deny",
        "write": "deny",
        "bash": {
          "*": "ask",
          "git status": "allow",
          "git diff": "allow",
          "git log*": "allow"
        }
      }
    },
    "review": {
      "description": "Code review with read-only access",
      "mode": "subagent",
      "temperature": 0.1,
      "tools": {
        "write": false,
        "edit": false,
        "bash": false
      }
    }
  },

  // Note: Additional agents defined in ~/.config/opencode/agent/*.md
  // - backend-architect.md: Backend systems design specialist
  // - security-engineer.md: Security vulnerabilities and compliance
  //
  // Additional commands defined in ~/.config/opencode/command/*.md
  // - implement.md: Feature implementation with framework detection
  // - analyze.md: Comprehensive code analysis
  // - refactor.md: Intelligent code refactoring

  // ============================================================================
  // PERMISSIONS
  // ============================================================================

  "permission": {
    "*": "allow",
    "bash": {
      "*": "allow",
      "rm -rf *": "ask",
      "rm -r *": "ask",
      "sudo *": "ask",
      "git push --force": "ask",
      "git push -f": "ask",
      "npm publish": "ask",
      "docker rm *": "ask",
      "docker rmi *": "ask"
    },
    "edit": "allow",
    "read": {
      "*": "allow",
      "*.env": "deny",
      "*.env.*": "deny",
      "*.env.local": "deny",
      "*.env.production": "deny",
      ".env": "deny",
      "*.key": "deny",
      "*.pem": "deny",
      "id_rsa": "deny",
      "*.env.example": "allow"
    },
    "write": "allow",
    "glob": "allow",
    "grep": "allow",
    "list": "allow",
    "task": "allow",
    "todoread": "allow",
    "todowrite": "allow",
    "webfetch": "allow",
    "external_directory": "ask",
    "doom_loop": "ask"
  },

  // ============================================================================
  // MCP SERVERS
  // ============================================================================

  "mcp": {
    "context7": {
      "type": "remote",
      "url": "https://mcp.context7.com/mcp",
      "enabled": true,
      "timeout": 10000
    },
    "serena": {
      "type": "local",
      "command": [
        "uvx",
        "--from",
        "git+https://github.com/oraios/serena",
        "serena",
        "start-mcp-server",
        "--context",
        "ide",
        "--project-from-cwd"
      ],
      "enabled": true,
      "timeout": 10000
    },
    "playwright": {
      "type": "local",
      "command": ["npx", "-y", "@executeautomation/playwright-mcp-server"],
      "enabled": true,
      "timeout": 10000
    }
  },

  // ============================================================================
  // FORMATTERS
  // ============================================================================

  "formatter": {
    "prettier": {
      "command": ["npx", "prettier", "--write", "$FILE"],
      "extensions": [
        ".js",
        ".ts",
        ".jsx",
        ".tsx",
        ".json",
        ".md",
        ".yaml",
        ".yml"
      ]
    },
    "biome": {
      "command": ["npx", "biome", "format", "--write", "$FILE"],
      "extensions": [".js", ".ts", ".jsx", ".tsx"]
    },
    "ruff": {
      "command": ["ruff", "format", "$FILE"],
      "extensions": [".py"]
    },
    "rustfmt": {
      "command": ["rustfmt", "$FILE"],
      "extensions": [".rs"]
    },
    "gofmt": {
      "command": ["gofmt", "-w", "$FILE"],
      "extensions": [".go"]
    }
  },

  // ============================================================================
  // LSP SERVERS
  // ============================================================================

  // OpenCode incluye 30+ servidores LSP integrados con auto-detección.
  // No se requiere configuración manual a menos que necesites personalizar
  // un servidor específico. Para servidores personalizados, incluye:
  // - command: ["executable", "args"] (obligatorio)
  // - extensions: [".ext"] (obligatorio)
  // - initialization: {} (opcional)
  // - disabled: false (opcional)
  //
  // Ejemplo de configuración personalizada:
  // "lsp": {
  //   "go": {
  //     "command": ["gopls"],
  //     "extensions": [".go"]
  //   }
  // }

  // ============================================================================
  // CONTEXT MANAGEMENT
  // ============================================================================

  "compaction": {
    "auto": true,
    "prune": true
  },

  // ============================================================================
  // FILE WATCHER
  // ============================================================================

  "watcher": {
    "ignore": [
      "node_modules/**",
      "dist/**",
      "build/**",
      ".git/**",
      ".next/**",
      ".nuxt/**",
      ".cache/**",
      "coverage/**",
      "*.log",
      ".DS_Store",
      "*.pyc",
      "__pycache__/**",
      ".pytest_cache/**",
      "target/**",
      "Cargo.lock",
      "package-lock.json",
      "yarn.lock",
      "pnpm-lock.yaml",
      "bun.lockb"
    ]
  },

  // ============================================================================
  // CUSTOM COMMANDS
  // ============================================================================

  "command": {
    "test": {
      "template": "Run the full test suite with coverage report and show any failures. Focus on the failing tests and suggest fixes.",
      "description": "Run tests with coverage",
      "agent": "build"
    },
    "docs": {
      "template": "Update or create documentation for the code at $ARGUMENTS. Include:\n- Clear explanation of functionality\n- Usage examples\n- Parameter descriptions\n- Return value documentation",
      "description": "Generate or update documentation"
    },
    "optimize": {
      "template": "Analyze and optimize the code at $ARGUMENTS for:\n- Performance improvements\n- Memory efficiency\n- Code readability\n- Best practices",
      "description": "Optimize code performance"
    },
    "analyze": {
      "template": "Analiza $ARGUMENTS usando Serena MCP:\n1. serena_get_symbols_overview() para estructura\n2. serena_find_symbol() para símbolos clave\n3. serena_search_for_pattern() para patrones\n4. Genera reporte y guarda en memoria",
      "description": "Análisis profundo con Serena MCP"
    },
    "refactor": {
      "template": "Refactoriza $ARGUMENTS usando Serena:\n1. serena_find_symbol() para encontrar\n2. serena_find_referencing_symbols() para referencias\n3. serena_rename_symbol() o serena_replace_symbol_body()\n4. Verifica cambios",
      "description": "Refactoring seguro con Serena"
    },
    "audit": {
      "template": "Audita el código en $ARGUMENTS:\n1. Buscar TODOs/FIXMEs con serena_search_for_pattern\n2. Buscar rutas hardcoded\n3. Buscar credenciales\n4. Verificar patrones inconsistentes\n5. Guardar reporte en memoria",
      "description": "Auditoría de código con Serena"
    },
    "s:find": {
      "template": "Usa serena_find_symbol(name_path_pattern=\"$ARGUMENTS\", include_body=true) para buscar el símbolo",
      "description": "Buscar símbolo con Serena"
    },
    "s:refs": {
      "template": "Usa serena_find_referencing_symbols(name_path=\"$ARGUMENTS\") para ver todas las referencias",
      "description": "Ver referencias con Serena"
    },
    "s:overview": {
      "template": "Usa serena_get_symbols_overview(relative_path=\"$ARGUMENTS\", depth=1) para ver la estructura",
      "description": "Vista general con Serena"
    },
    "s:todos": {
      "template": "Usa serena_search_for_pattern(substring_pattern=\"TODO|FIXME|HACK\", relative_path=\".\", context_lines_after=2) para buscar TODOs",
      "description": "Buscar TODOs con Serena"
    }
  },

  // ============================================================================
  // INSTRUCTIONS & RULES
  // ============================================================================

  "instructions": ["CLAUDE.md", "AGENTS.md"],

  // ============================================================================
  // SYSTEM SETTINGS
  // ============================================================================

  "autoupdate": "notify",
  "share": "manual"
}
